<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minecraft Crafting sla</title>

<style>
@font-face {
  font-family: 'Minecraft';
  src: url('https://fonts.cdnfonts.com/s/17303/Minecraft-Regular.woff') format('woff');
}

* {
  box-sizing: border-box;
  image-rendering: pixelated;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: 'Minecraft', monospace;
  background-image: url("https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/1.20/assets/minecraft/textures/block/grass_block_top.png");
  background-size: 64px 64px;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  z-index: -1;
}

h1 {
  margin: 20px;
  text-shadow: 2px 2px #000;
}

.panel {
  background: #c6c6c6;
  border: 4px solid #000;
  box-shadow: inset -4px -4px #555, inset 4px 4px #fff;
  padding: 12px;
  color: #000;
}

.game {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3,64px);
  gap: 4px;
  padding: 8px;
  background-image: url("https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/1.20/assets/minecraft/textures/block/crafting_table_top.png");
  background-size: cover;
}

.inventory {
  display: grid;
  grid-template-columns: repeat(4,64px);
  gap: 4px;
}

.slot, .item {
  width: 64px;
  height: 64px;
  background: #8b8b8b;
  border: 4px solid #000;
  box-shadow: inset -4px -4px #373737, inset 4px 4px #dcdcdc;
  display: flex;
  align-items: center;
  justify-content: center;
}

.item.selected {
  outline: 4px solid #fff;
  outline-offset: -6px;
}

img {
  width: 42px;
  height: 42px;
  pointer-events: none;
}

button {
  margin-top: 8px;
  padding: 8px 16px;
  font-family: 'Minecraft';
  background: #c6c6c6;
  border: 4px solid #000;
  box-shadow: inset -4px -4px #555, inset 4px 4px #fff;
  cursor: pointer;
}

button:active {
  box-shadow: inset 4px 4px #555, inset -4px -4px #fff;
}

.info {
  text-align: center;
  margin-bottom: 10px;
}
.skill-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.skill-overlay.hidden {
  display: none;
}

.skill-menu {
  width: 320px;
  text-align: center;
}

.skills {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

.skills button {
  font-size: 16px;
}

.info.panel {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.info.panel p {
  margin: 0;
  white-space: nowrap;
}

#targetImg {
  width: 42px;
  height: 42px;
}

.zoom-box {
  width: 128px;
  height: 128px;
  overflow: hidden;
  margin: auto;
  border: 4px solid #000;
  background: #8b8b8b;
}

.zoom-box img {
  width: 512px;
  height: 512px;
  image-rendering: pixelated;
}

#guessInput {
  margin-top: 10px;
  padding: 6px;
  width: 90%;
  font-family: 'Minecraft';
}

.suggestions {
  display: flex;
  flex-direction: column;
  margin-top: 6px;
}

.suggestions div {
  background: #c6c6c6;
  border: 2px solid #000;
  padding: 4px;
  cursor: pointer;
}

.suggestions div:hover {
  background: #a0a0a0;
}

.zoom-box.success {
  animation: flash 0.4s ease;
}

@keyframes flash {
  0%   { box-shadow: 0 0 0 4px #0f0; }
  50%  { box-shadow: 0 0 12px 6px #0f0; }
  100% { box-shadow: 0 0 0 4px #000; }
}


</style>
</head>

<body>
<div id="skillOverlay" class="skill-overlay hidden">
  <div class="skill-menu panel">
    <h2>Escolha uma habilidade</h2>

    <div class="skills">
      <button onclick="pickSkill('life')">‚ù§Ô∏è +1 Vida</button>
      <button onclick="pickSkill('time')">‚è≥ +Tempo</button>
      <button onclick="pickSkill('skip')">‚è≠Ô∏è Pular Crafting</button>
    </div>
  </div>
</div>


<h1>Crafting e sei la</h1>

<div class="panel" style="margin-bottom:10px">
  <button onclick="setMode('craft')">Modo Crafting</button>
  <button onclick="setMode('guess')">Modo Adivinha√ß√£o</button>
  <button onclick="setMode('image')">Modo Imagem</button>

</div>


<div class="info panel">
  <p>Objetivo:</p>
  <img id="targetImg">
  <p id="targetName"></p>
  <p>Pontos: <span id="score">0</span></p>
  <p>Vidas: <span id="lives">‚ù§ ‚ù§ ‚ù§</span></p>
<p>Tempo: <span id="timer">20</span>s</p>

<p>Pulos: <span id="skips">0</span></p>
<button onclick="useSkip()">Pular crafting</button>


</div>
<div id="imageMode" class="panel" style="display:none;text-align:center">
  <div class="zoom-box">
    <img id="zoomImg">
  </div>

  <input
    id="guessInput"
    type="text"
    placeholder="Digite o nome do item..."
    autocomplete="off"
  >

  <div id="suggestions" class="suggestions"></div>
</div>


<div class="game">
  <div class="panel">
    <div class="grid" id="craft"></div>
    <button onclick="clearCraft()">Limpar Mesa</button>
  </div>

  <div style="display:flex;align-items:center;gap:12px;margin-top:10px">
  <span style="font-size:24px">‚Üí</span>
  <div class="slot" id="resultSlot"></div>
</div>


  <div class="panel">
    <h3>Invent√°rio</h3>
    <div id="inv" class="inventory"></div>
  </div>
</div>

<script>


/*  CONFIG  */
const BASE = 'https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/1.20/assets/minecraft/textures/';
const LOCAL_IMG = './img/'; // ‚úÖ pasta local

const I = n => BASE + 'item/' + n + '.png';
const B = n => BASE + 'block/' + n + '.png';
const E = n => BASE + 'entity/chest/' + n + '.png';

const livesEl = document.getElementById('lives');
const timerEl = document.getElementById('timer');

const skipsEl = document.getElementById('skips');

function updateSkipUI() {
  skipsEl.textContent = skips;
}


function updateLives() {
  livesEl.textContent = '‚ù§ '.repeat(lives).trim();
}

function startTimer() {
  if (gameMode === 'image') return;

  clearInterval(timerInterval);

  const difficultyReduction = Math.floor(score / 10);

  const maxTime =
    baseTime +
    timeBonusPermanent -
    difficultyReduction;

  timeLeft = Math.max(minTime, maxTime);

  timerEl.textContent = timeLeft;

  timerInterval = setInterval(() => {
    timeLeft--;
    timerEl.textContent = timeLeft;

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      loseLife();
    }
  }, 1000);
}



function useSkip() {
  if (skips <= 0) return;

  skips--;
  updateSkipUI();

  clearInterval(timerInterval);
  next();
  startTimer();
}


function checkSkills() {
  const expected = Math.floor(score / 100);

  if (expected > skillPoints) {
    skillPoints = expected;
    openSkillMenu();
  }
}

function openSkillMenu() {
  clearInterval(timerInterval);
  document.getElementById('skillOverlay').classList.remove('hidden');
}

function pickSkill(type) {
  const overlay = document.getElementById('skillOverlay');
  overlay.classList.add('hidden');

  if (type === 'life') {
    if (lives < 3) lives++;
    updateLives();
  }

  if (type === 'time') {
  const bonus = Math.floor(Math.random() * 11) + 20;
  timeBonusPermanent += bonus;
}


  if (type === 'skip') {
    skips++;
    updateSkipUI();
  }

  startTimer();
}



function loseLife() {
  lives--;
  updateLives();

  if (lives <= 0) {
    gameOver();
    return;
  }

  next();

  if (gameMode !== 'image') {
    startTimer();
  }
}


function gameOver() {
  alert("GAME OVER üíÄ\nPontua√ß√£o: " + score);
  location.reload();
}


function imageFallback(img) {
  const key = img.dataset.item;
  if (!key) return;

  if (!img.dataset.triedLocal) {
    img.dataset.triedLocal = '1';
    img.src = LOCAL_IMG + key + '.png';
  } else {
    img.src = BASE + 'item/barrier.png';
  }
}

/*  ITENS  */
const items = {
  plank: B('oak_planks'),
  log: B('oak_log'),
  stick: I('stick'),
  cobble: B('cobblestone'),
  stone: B('stone'),
  glass: B('glass'),
  wool: B('white_wool'),
  coal: I('coal'),
  diamond: I('diamond'),
  gold_ingot: I('gold_ingot'),
  iron_ingot: I('iron_ingot'),
  redstone: I('redstone'),
  quartz: I('quartz'),
  string: I('string'),
  leather: I('leather'),
  torch: I('torch'),

  crafting_table: B('crafting_table_top'),
  furnace: B('furnace_front'),
  chest: E('normal'),

  ladder: I('ladder'),
  bookshelf: B('bookshelf'),
  stone_pickaxe: I('stone_pickaxe'),
  iron_pickaxe: I('iron_pickaxe'),
  diamond_pickaxe: I('diamond_pickaxe'),
  gold_pickaxe: I('golden_pickaxe'),

  piston: B('piston'),
  iron_block: B('iron_block'),
  gold_block: B('gold_block'),
  diamond_block: B('diamond_block'),
  glass_pane: I('glass_pane'),
  white_carpet: I('white_carpet')
};

/*  RECEITAS  */
 const recipes = [
  { result:'plank', pattern:[['log']] },
  { result:'stick', pattern:[['plank'],['plank']] },
  { result:'crafting_table', pattern:[['plank','plank'],['plank','plank']] },
  { result:'chest', pattern:[['plank','plank','plank'],['plank',null,'plank'],['plank','plank','plank']] },
  { result:'furnace', pattern:[['cobble','cobble','cobble'],['cobble',null,'cobble'],['cobble','cobble','cobble']] },

  { result:'stone_pickaxe', pattern:[['cobble','cobble','cobble'],[null,'stick',null],[null,'stick',null]] },
  { result:'iron_pickaxe', pattern:[['iron_ingot','iron_ingot','iron_ingot'],[null,'stick',null],[null,'stick',null]] },
  { result:'gold_pickaxe', pattern:[['gold_ingot','gold_ingot','gold_ingot'],[null,'stick',null],[null,'stick',null]] },
  { result:'diamond_pickaxe', pattern:[['diamond','diamond','diamond'],[null,'stick',null],[null,'stick',null]] },

  { result:'piston', pattern:[['plank','plank','plank'],['cobble','iron_ingot','cobble'],['cobble','redstone','cobble']] },

  { result:'iron_block', pattern:[['iron_ingot','iron_ingot','iron_ingot'],['iron_ingot','iron_ingot','iron_ingot'],['iron_ingot','iron_ingot','iron_ingot']] },
  { result:'gold_block', pattern:[['gold_ingot','gold_ingot','gold_ingot'],['gold_ingot','gold_ingot','gold_ingot'],['gold_ingot','gold_ingot','gold_ingot']] },
  { result:'diamond_block', pattern:[['diamond','diamond','diamond'],['diamond','diamond','diamond'],['diamond','diamond','diamond']] },

  { result:'glass_pane', pattern:[['glass','glass','glass'],['glass','glass','glass']] },
  { result:'white_carpet', pattern:[['wool','wool']] },
  { result:'ladder', pattern:[['stick',null,'stick'],['stick','stick','stick'],['stick',null,'stick']] },
  { result:'bookshelf', pattern:[['plank','plank','plank'],['leather','leather','leather'],['plank','plank','plank']] },

  { result:'torch', pattern:[['coal'],['stick']] }
];

let baseTime = 20;
let minTime = 4;
let skillPoints = 0;
let skips = 0;
let grid = Array(9).fill(null);
let gameMode = 'craft';
let selected = null;
let target = null;
let score = 0;
let lives = 3;
let timeLeft = 10;
let timerInterval = null;
let pendingRecipe = null;
let lastCrafted = null;
let recentCrafts = [];
let timeBonusPermanent = 0;
let imageTarget = null;
let imageZoom = 512;
let imageOffset = { x: 0, y: 0 };



const COOLDOWN = 3; 
const resultSlot = document.getElementById('resultSlot');


const craftDiv = document.getElementById('craft');
const invDiv = document.getElementById('inv');
const targetImg = document.getElementById('targetImg');
const targetName = document.getElementById('targetName');
const scoreEl = document.getElementById('score');

const ingredientesUsados = new Set();

const guessInput = document.getElementById('guessInput');
const suggestions = document.getElementById('suggestions');

guessInput.addEventListener('input', () => {
  const value = guessInput.value.toLowerCase();
  suggestions.innerHTML = '';

  if (!value) return;

  Object.keys(items)
    .filter(k => k.replaceAll('_',' ').includes(value))
    .slice(0, 6)
    .forEach(k => {
      const div = document.createElement('div');
      div.textContent = k.replaceAll('_',' ');
      div.onclick = () => selectGuess(k);
      suggestions.appendChild(div);
    });
});


recipes.forEach(r => {
  r.pattern.forEach(linha => {
    linha.forEach(item => {
      if (item) ingredientesUsados.add(item);
    });
  });
});

ingredientesUsados.forEach(k => {
  if (!items[k]) return;

  const d = document.createElement('div');
  d.className = 'item';
  d.innerHTML = `<img src="${items[k]}" data-item="${k}" onerror="imageFallback(this)">`;

  d.onclick = () => {
    document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
    d.classList.add('selected');
    selected = k;
  };

  invDiv.appendChild(d);
});


for(let i=0;i<9;i++){
  const s=document.createElement('div');
  s.className='slot';
  s.onclick = ()=>{
  if (gameMode === 'guess') return;

  grid[i] = selected;
  render();
  check();
};

  craftDiv.appendChild(s);
}

function buildInventory(){
  invDiv.innerHTML = '';
  selected = null;

  let list = [];

  if (gameMode === 'craft') {
    // ingredientes (modo normal)
    list = [...ingredientesUsados];
  } else {
    // resultados (modo adivinha√ß√£o)
    list = [...new Set(recipes.map(r => r.result))];
  }

  list.forEach(k => {
    if (!items[k]) return;

    const d = document.createElement('div');
    d.className = 'item';
    d.innerHTML = `<img src="${items[k]}" data-item="${k}" onerror="imageFallback(this)">`;

    d.onclick = () => {
      document.querySelectorAll('.item').forEach(i => i.classList.remove('selected'));
      d.classList.add('selected');
      selected = k;

      // no modo adivinha√ß√£o, clicar pode dar erro e etc
      if (gameMode === 'guess') {
        guessResult(k);
      }
    };

    invDiv.appendChild(d);
  });
}


function setMode(mode){
  gameMode = mode;

  document.getElementById('imageMode').style.display =
    mode === 'image' ? 'block' : 'none';

  craftDiv.style.display =
    mode === 'image' ? 'none' : 'grid';

  invDiv.style.display =
    mode === 'image' ? 'none' : 'grid';

  score = 0;
  lives = 3;
  updateLives();
  scoreEl.textContent = score;

  clearInterval(timerInterval);
  clearCraft();

  buildInventory();

  next();

  if (mode !== 'image') {
    startTimer();
  } else {
    timerEl.textContent = '‚Äî';
  }
}


function showImageSuccess() {
  const box = document.querySelector('.zoom-box');
  box.classList.add('success');

  setTimeout(() => {
    box.classList.remove('success');
  }, 400);
}


function selectGuess(choice) {
  const img = document.getElementById('zoomImg');

  if (choice === imageTarget) {
    // ACERTOU üéâ
    score += 10;
    scoreEl.textContent = score;
    checkSkills();
    showImageSuccess();

    clearInterval(timerInterval);
    setTimeout(() => {
      nextImageRound();
    }, 600);

  } else {
  // ERROU

  lives--;
  updateLives();

  if (lives <= 0) {
    gameOver();
    return;
  }

 imageZoom = Math.max(96, imageZoom - 128);


  img.style.width = imageZoom + 'px';
  img.style.height = imageZoom + 'px';
  img.style.transform =
    `translate(-${imageOffset.x}px, -${imageOffset.y}px)`;
}

}



function nextImageRound() {

  lives = 3;
  updateLives();

  const keys = Object.keys(items);
  imageTarget = keys[Math.floor(Math.random() * keys.length)];

  const img = document.getElementById('zoomImg');
  img.src = items[imageTarget];
  img.dataset.item = imageTarget;
  img.onerror = () => imageFallback(img);

  imageZoom = 512;

  imageOffset.x = Math.floor(Math.random() * 384);
  imageOffset.y = Math.floor(Math.random() * 384);

  img.style.width = imageZoom + 'px';
  img.style.height = imageZoom + 'px';
  img.style.transform =
    `translate(-${imageOffset.x}px, -${imageOffset.y}px)`;

  document.getElementById('guessInput').value = '';
  document.getElementById('suggestions').innerHTML = '';
}



function render(){
  [...craftDiv.children].forEach((s,i)=>{
    s.innerHTML = grid[i]
      ? `<img src="${items[grid[i]]}" data-item="${grid[i]}" onerror="imageFallback(this)">`
      : '';
  });
}

function normalize(){
  const m=[grid.slice(0,3),grid.slice(3,6),grid.slice(6,9)];
  const rows=m.filter(r=>r.some(c=>c));
  if(!rows.length) return [];
  const cols=[0,1,2].filter(c=>rows.some(r=>r[c]));
  return rows.map(r=>cols.map(c=>r[c]||null));
}

function match(a,b){
  if(a.length!==b.length||a[0].length!==b[0].length) return false;
  for(let y=0;y<b.length;y++)
    for(let x=0;x<b[0].length;x++)
      if(a[y][x]!==b[y][x]) return false;
  return true;
}

function check(){
  const n = normalize();
  pendingRecipe = null;
  resultSlot.innerHTML = '';

  for(const r of recipes){
    if(match(n, r.pattern)){
      pendingRecipe = r;

      resultSlot.innerHTML = `
        <img src="${items[r.result]}"
             data-item="${r.result}"
             onerror="imageFallback(this)"
             style="cursor:pointer">
      `;

      resultSlot.onclick = craftResult;
      break;
    }
  }
}

function craftResult(){
  // nao faz nada se n√£o for a receita certa
  if (!pendingRecipe) return;

  // so aceita se for o item certo
  if (pendingRecipe.result !== target.result) {
    return;
  }

  // ganha pontos
  score += 10;
  scoreEl.textContent = score;
  checkSkills();


  // controle de repeti√ß√£o
  lastCrafted = pendingRecipe.result;
  recentCrafts.push(lastCrafted);

  if (recentCrafts.length > COOLDOWN) {
    recentCrafts.shift();
  }

  // limpa a mesa
  clearCraft();
  resultSlot.innerHTML = '';
  pendingRecipe = null;

  // reinicia o timer e passa para o pr√≥ximo
  clearInterval(timerInterval);
  next();

if (gameMode !== 'image') {
  startTimer();
} else {
  clearInterval(timerInterval);
  timerEl.textContent = '‚Äî';
}

}

function guessResult(choice){
  if (!target) return;

  if (choice === target.result) {
    // acertou
    score += 10;
    scoreEl.textContent = score;
    checkSkills();


    clearInterval(timerInterval);
    next();
    startTimer();
  } else {
    // errou
    loseLife();
  }
}

function updateObjectiveUI() {
  if (gameMode === 'guess') {
    targetImg.style.display = 'none';
    targetName.style.display = 'none';
  } else {
    targetImg.style.display = 'block';
    targetName.style.display = 'block';
  }
}


function clearCraft(){
  grid.fill(null);
  render();
  resultSlot.innerHTML = '';
  pendingRecipe = null;
}


function next(){

  let pool = recipes.filter(r =>
    r.result !== lastCrafted &&
    !recentCrafts.includes(r.result)
  );

  if (pool.length === 0) {
    pool = recipes;
  }

  target = pool[Math.floor(Math.random() * pool.length)];

  updateObjectiveUI();

  //  MODO NORMAL 
  if (gameMode === 'craft') {
    targetImg.src = items[target.result];
    targetImg.dataset.item = target.result;
    targetImg.onerror = () => imageFallback(targetImg);
    targetName.textContent = target.result.replaceAll('_',' ').toUpperCase();

    clearCraft();
  }

  if (gameMode === 'image') {
  nextImageRound();
}


  // MODO ADIVINHA√á√ÉO
  if (gameMode === 'guess') {
    clearCraft();

    const p = target.pattern;
    const h = p.length;
    const w = p[0].length;

    const startRow = Math.floor((3 - h) / 2);
    const startCol = Math.floor((3 - w) / 2);

    for (let y = 0; y < h; y++) {
      for (let x = 0; x < w; x++) {
        const item = p[y][x];
        if (item) {
          const index = (startRow + y) * 3 + (startCol + x);
          grid[index] = item;
        }
      }
    }

    render();
  }
}

buildInventory();
setMode('craft');


next();
</script>

</body>
</html>
